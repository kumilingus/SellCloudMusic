/*
	Transform Plugin
	Copyright (c) 2009 DAER Systems (daersystems.com)
	Dual licensed under the GPL (http://www.gnu.org/licenses/gpl.html)
	and MIT (http://www.opensource.org/licenses/mit-license.php) licenses.
*/
(function(e){e.transform=function(b){var k=function(a){if(e.browser.msie){var c=e("<xml>")[0];c.loadXML(a);return c}return(new DOMParser).parseFromString(a,"text/xml")},g=function(a,c,f,d){if(e.isFunction(a)){var h=f.html();if("JSON"==c.c.dataType.toUpperCase())try{h=eval("("+f.text()+")")}catch(b){h={error:"An error occurred while converting HTML to JSON"}}"XML"==c.c.dataType.toUpperCase()&&(h=k(f.html()));try{a.apply(c.c,[h,c.c.xslstr,c.c.xmlstr,c.c,d])}catch(g){}}};this.c={cache:!1,async:!0,xsl:!1,
xml:!1,xslstr:!1,xmlstr:!1,xslobj:!1,xmlobj:!1,xslParams:!1,error:!1,success:!1,complete:!1,island:!1,pass:!1,msg:!1,dataType:"html"};e.extend(this.c,b);b.msg&&e(b.el).html("string"==typeof b.msg?b.msg:e(b.msg).html());var q=function(a){var c=a+"_"+Math.round(999*Math.random());return 0===e("#"+c).length?c:q(a)},r=function(a,c){c.c.xsl=c.c.xsl?c.c.xsl:"";var f="file:"==location.protocol&&e.browser.msie?"\\":"/",d=location.protocol+f+f+location.host,b=location.pathname.substring(0,location.pathname.lastIndexOf(f)+
1)+c.c.xsl.substring(0,c.c.xsl.lastIndexOf("/")+1);if(a.substring(0,1)==f)return d+a;if(".."==a.substring(0,2)){for(var g=0;-1!=a.indexOf("..");)a=a.substring(a.indexOf("..")+3),g+=1;d+=b.substring(0,b.length-1);for(b=0;b<g;b++)d=d.substring(0,d.lastIndexOf(f));return d+f+a}return d+b+a},n=function(a){if((a.c.xslstr||a.c.xslobj)&&(a.c.xmlstr||a.c.xmlobj)){var c=!1,b=e("<div>");if(a.c.throwerror)g(a.c.error,a,b,{message:"Bad XML or XSL call"});else{a.c.island&&(!0===a.c.island&&(a.c.island="body"),
a.c.xslid=q("xsl"),e(a.c.island).append("<div id='"+a.c.xslid+"' name='"+a.c.xslid+"' style='display:none;'>"+a.c.xslstr+"</div>"),a.c.xmlid=q("xml"),e(a.c.island).append("<div id='"+a.c.xmlid+"' name='"+a.c.xmlid+"' style='display:none;'>"+a.c.xmlstr+"</div>"));a.c.xslobj=a.c.xslobj?a.c.xslobj:k(a.c.xslstr);a.c.xmlobj=a.c.xmlobj?a.c.xmlobj:k(a.c.xmlstr);var d,h;if(e.browser.msie)try{d=function(b,e){for(var c=e.selectNodes(b),d=0;d<c.length;d++)c[d].setAttribute("href",r(c[d].getAttribute("href"),
a))},d("//xsl:include",a.c.xslobj),d("//xsl:import",a.c.xslobj),h=function(a,b){for(var c in a){var e="//xsl:param[@name='"+c+"']";try{var d=a[c];"boolean"===typeof d?d="'"+d+"'":isNaN(parseInt(d))&&0>d.indexOf("'")&&(d="'"+d+"'");var f=b.selectSingleNode(e);if(null==f){var g=b.createElement("xsl:param");g.setAttribute("name",c);b.documentElement.insertBefore(g,b.selectSingleNode("//xsl:template"));f=b.selectSingleNode(e)}f.setAttribute("select",d)}catch(h){}}},a.c.xslParams&&(h(a.c.xslParams,a.c.xslobj),
a.c.xslobj=k(a.c.xslobj.xml)),b.empty().html(a.c.xmlobj.transformNode(a.c.xslobj))}catch(n){c=!0,g(a.c.error,a,b,n)}else try{var p=new XSLTProcessor,l=function(a,b){for(var d=[],c=a.getElementsByTagName(b),e=0;e<c.length;e++)c[e].parentNode==a&&(d[d.length]=c[e]);return d},m=function(a,b){for(var d=e.merge(e.makeArray(a.getElementsByTagName("import")),e.makeArray(a.getElementsByTagName("include"))),c=0;c<d.length;c++){var f=d[c];e.ajax({passData:{node:f,xObj:a,rootConfig:b},dataType:"xml",async:!1,
url:r(f.getAttribute("href"),b),success:function(a){try{var b=this.passData;a=m(a,b.rootConfig);var d=e.merge(l(a.getElementsByTagName("stylesheet")[0],"param"),l(a.getElementsByTagName("stylesheet")[0],"template"));try{var c=b.xObj,f=l(c,"param"),g=l(c,"template");existingNodes=e.merge(f,g)}catch(h){}a=[];c=[];for(f=0;f<existingNodes.length;f++)existingNodes[f].getAttribute("name")?a[existingNodes[f].getAttribute("name")]=!0:c[existingNodes[f].getAttribute("match")]=!0;for(var s=b.node.parentNode,
f=0;f<d.length;f++)if(!a[d[f].getAttribute("name")]&&!c[d[f].getAttribute("match")]){var k=b.xObj.ownerDocument.importNode(d[f],!0);s.insertBefore(k,l(b.xObj,"template")[0])}s.removeChild(b.node)}catch(v){}}})}return a};d=function(b,c){b=e.browser.mozilla&&"1.9"==e.browser.version.substring(0,3)?"xsl:"+b:b;for(var d=c.getElementsByTagName(b),f=0;f<d.length;f++)d[f].setAttribute("href",r(d[f].getAttribute("href"),a))};e.browser.safari?a.c.xslobj=m(a.c.xslobj,a):(d("import",a.c.xslobj),d("include",
a.c.xslobj));h=function(a){for(var b in a)try{p.setParameter(null,b,a[b])}catch(d){}};h(a.c.xslParams);var t=document.implementation.createDocument("","",null);p.importStylesheet(a.c.xslobj);b.empty().append(p.transformToFragment(a.c.xmlobj,t))}catch(u){c=!0,g(a.c.error,a,b,u)}a.c.el&&b.html()&&e(a.c.el).html(b.html());c||g(a.c.success,a,b);g(a.c.complete,a,b);return b.html()}}},m=function(a,b,f){"string"==typeof b&&(b={cache:!1,url:b,dataType:"xml",async:a.c.async,pass:a.c.pass});b.complete=function(b,
c){"success"!=c?a.c.threwError||(a.c.threwError=!0,g(a.c.error,a,e("<div>"+b.responseText+"</div>"),{message:"Error requesting file "+this.url}),g(a.c.complete,a,e("<div>"+b.responseText+"</div>"))):("XSL"==f?200==b.status?a.c.xslstr=b.responseText:(a.c.xslstr="error",a.c.throwerror=!0):200==b.status?a.c.xmlstr=b.responseText:(a.c.xmlstr="error",a.c.throwerror=!0),a.c.async&&n(a))};e.ajax(b)};this.c.xsl&&m(this,b.xsl,"XSL");this.c.xml&&m(this,b.xml,"XML");if(!this.c.async||this.c.xmlstr||this.c.xmlobj||
this.c.xslstr||this.c.xslobj)return n(this)};e.fn.transform=function(b){return this.each(function(){b=b?b:{};b.el=this;new e.transform(b)})}})(jQuery);$().ready(function(){$("[transform]").each(function(e,b){$(b).transform(eval("("+$(b).attr("transform")+")"))})});